% !TeX root = ./ruled.tex
\documentclass[UTF8]{ctexart}

% Adjust paper and printer parameters in the following file
\input{paper-printer}

% Declare template name
\def\template{ruled lines with slanted guides}

% Declare nib width as a basic unit
\def\nibwidth{1.1mm}

% Declare horizontal guidelines using letter proportions and nib width
\def\ascenderNW{9}
\def\capNW{8}
\def\xheightNW{4}
\def\descenderNW{5}
\def\ysepNW{1}

% Declare slanted guidelines using nib width
\def\slantdegree{65}
\def\slantsepNW{9}
\def\slantoffsetNW{5.5}

% Declare line colors
\providecolor{scolora}{cmyk:named}{cyan!66!yellow!40}
\providecolor{scolorc}{cmyk:named}{black!40}
\providecolor{scolorx}{cmyk:named}{black!15}
\providecolor{scolorb}{cmyk:named}{black!15}
\providecolor{scolord}{cmyk:named}{cyan!66!yellow!40}
\providecolor{scolors}{cmyk:named}{black!40}

% Declare a tikz pic for stamping top to bottom
\tikzset{
  /s/ascender/.style = {
      scolora,
      line cap=butt,
      line width=0.2mm,
      dash pattern=on 2*\nibwidth off \nibwidth,
      dash phase=\ay/tan(\slantdegree)
    },
  /s/cap/.style = {
      scolorc,
      line cap=round,
      line width=0.2mm,
      dash pattern=on 0*\nibwidth off \nibwidth,
      dash phase=(\ay+(\ascenderNW-\capNW)*\nibwidth)/tan(\slantdegree)-\nibwidth/2
    },
  /s/xheight/.style = {
      scolorx,
      line cap=butt,
      line width=0.1mm,
    },
  /s/baseline/.style = {
      scolorb,
      line cap=butt,
      line width=0.1mm,
    },
  /s/descender/.style = {
      scolord,
      line cap=butt,
      line width=0.2mm,
      dash pattern=on 2*\nibwidth off \nibwidth,
      dash phase=(\ay+(\ascenderNW+\descenderNW)*\nibwidth)/tan(\slantdegree)
    },
  pics/ystamp/.style={
      code={
          \draw [/s/ascender]  (${\descenderNW+\ascenderNW}*(0,\nibwidth)$) -- +(\totalwidth,0);
          \draw [/s/cap]       (${\descenderNW+\capNW     }*(0,\nibwidth)$) -- +(\totalwidth,0);
          \draw [/s/xheight]   (${\descenderNW+\xheightNW }*(0,\nibwidth)$) -- +(\totalwidth,0);
          \draw [/s/baseline]  (${\descenderNW            }*(0,\nibwidth)$) -- +(\totalwidth,0);
          \draw [/s/descender] (${0                       }*(0,\nibwidth)$) -- +(\totalwidth,0);
          % Baseline circle
          \draw [/s/baseline]  (${\descenderNW            }*(0,\nibwidth)$) circle (\nibwidth/2) [fill=white];
        }
    }
}

% Declare a tikz pic for stamping left to right
\tikzset{
  /s/slanted/guide/.style = {
      scolors,
      line cap=round,
      line width=0.2mm,
      xshift=\slantoffsetNW*\nibwidth,
      dash pattern=on 0*\nibwidth off \nibwidth/sin(\slantdegree)
    },
  /s/slanted/ends/.style = {
      scolors,
      line cap=round,
      line width=0.2mm,
      xshift=\slantoffsetNW*\nibwidth
    },
  pics/xstamp/.style={
      code={
          % Uncomment the next three lines if you want the end arcs
          % \draw [/s/slanted/ends, shift=(-180:  \nibwidth/2),fill=white]
          % (0,0)                     arc ( 180:0:\nibwidth/2)
          % (\slantdegree-180:\sslen) arc (-180:0:\nibwidth/2);

          \draw [/s/slanted/guide] (0,0) -- (\slantdegree-180:\sslen);
        }
    }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Everything below this line is not intended to be user-configurable

% Compute stamping lengths and separations
\pgfmathsetlengthmacro{\sxlen}{0mm}
\pgfmathsetlengthmacro{\sxsep}{\nibwidth*\slantsepNW}
\pgfmathsetlengthmacro{\sylen}{\nibwidth*(\ascenderNW+\descenderNW)}
\pgfmathsetlengthmacro{\sysep}{\nibwidth*\ysepNW}

% Compute the number of stamps that can fit in printable area
\pgfmathsetmacro{\nx}{int((\textwidth +\sxsep)/(\sxlen+\sxsep))}
\pgfmathsetmacro{\ny}{int((\textheight+\sysep)/(\sylen+\sysep))}

% Set PDF properties
\extractcolorspec{scolora}{\scolora}
\extractcolorspec{scolorc}{\scolorc}
\extractcolorspec{scolorx}{\scolorx}
\extractcolorspec{scolorb}{\scolorb}
\extractcolorspec{scolord}{\scolord}
\extractcolorspec{scolors}{\scolors}
\def\pdftitle{\ny{} \template{} for \nibwidth{} nibs, with
  ascender at \ascenderNW{} nibs,
  caps at \capNW{} nibs,
  x-height at \xheightNW{} nibs,
  descender at -\descenderNW{} nibs,
  and \slantdegree\textdegree-guides separated at \slantsepNW{} nibs}
\hypersetup{
  pdftitle=\pdftitle,
  pdfkeywords={%
      \template,
      a=\scolora; c=\scolorc;,
      x=\scolorx; b=\scolorb;,
      d=\scolord; s=\scolors,
    },
  pdfsubject={https://github.com/maverickwoo/paperpad-templates},
  pdfauthor={Maverick Woo}
}

\input{body}
