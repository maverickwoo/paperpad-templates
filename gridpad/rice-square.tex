% !TeX root = ./rice-square.tex
\documentclass[UTF8]{ctexart}

% Adjust paper and printer parameters in the following file
\input{paper-printer}

% Name the grid
\def\gridname{rice-square grid (米字格)}

% Declare stamp dimensions and separations
\def\stampheight{13mm}\def\stampvsep{0mm}
\def\stampwidth {13mm}\def\stamphsep{0mm}

% Declare a tikz pic for stamping onto the grid
\providecolor{stampcolora}{cmyk:named}{magenta!66!yellow!50}
\providecolor{stampcolorb}{cmyk:named}{cyan!66!yellow!60}
\pgfmathsetlengthmacro{\stampdiagonal}{sqrt(\stampheight*\stampheight+\stampwidth*\stampwidth)}
\pgfmathsetlengthmacro{\stamphdash}{\stampwidth/3/2/2}
\pgfmathsetlengthmacro{\stampvdash}{\stampheight/3/2/2}
\pgfmathsetlengthmacro{\stampddash}{\stampdiagonal/5/2/2}
\tikzset{
  stamp majorline/.style = {
      stampcolora,
      line cap=rect,
      line width=0.3mm
    },
  stamp minorlineh/.style = {
      stampcolorb,
      line cap=butt,
      line width=0.15mm,
      dash pattern=on \stamphdash off \stamphdash,
      dash phase=0.5*\stamphdash % on-center: 0.5; off-center: 1.5
    },
  stamp minorlinev/.style = {
      stampcolorb,
      line cap=butt,
      line width=0.15mm,
      dash pattern=on \stampvdash off \stampvdash,
      dash phase=0.5*\stampvdash % on-center: 0.5; off-center: 1.5
    },
  stamp minorlined/.style = {
      stampcolorb,
      line cap=butt,
      line width=0.15mm,
      dash pattern=on \stampddash off \stampddash,
      dash phase=1.5*\stampddash % on-center: 0.5; off-center: 1.5
    },
  pics/stamp/.style={
      code={
          % Diagonal
          \draw [stamp minorlined]                                          (  45:0.5*\stampddash) -- +(  45:8.5*\stampddash);
          \draw [stamp minorlined] [yshift=\stampheight]                    ( -45:0.5*\stampddash) -- +( -45:8.5*\stampddash);
          \draw [stamp minorlined] [xshift=\stampwidth]                     ( 135:0.5*\stampddash) -- +( 135:8.5*\stampddash);
          \draw [stamp minorlined] [xshift=\stampwidth,yshift=\stampheight] (-135:0.5*\stampddash) -- +(-135:8.5*\stampddash);
          % Horizontal
          \draw [stamp minorlineh] (0,\stampheight/2) -- (\stampwidth,\stampheight/2);
          % Vertical
          \draw [stamp minorlinev] (\stampwidth/2,0) -- (\stampwidth/2,\stampheight);
          % Horizontal
          \draw [stamp majorline ] (0,           0  ) -- (\stampwidth,           0  );
          \draw [stamp majorline ] (0,\stampheight  ) -- (\stampwidth,\stampheight  );
          % Vertical
          \draw [stamp majorline ] (          0  ,0) -- (          0  ,\stampheight);
          \draw [stamp majorline ] (\stampwidth  ,0) -- (\stampwidth  ,\stampheight);
        }
    }
}

% Compute the number of stamps that can fit in printable area
\pgfmathsetmacro{\nx}{int((\textwidth +\stamphsep)/(\stampwidth +\stamphsep))}
\pgfmathsetmacro{\ny}{int((\textheight+\stampvsep)/(\stampheight+\stampvsep))}

% Set PDF properties
\extractcolorspec{stampcolora}{\stampcolora}
\extractcolorspec{stampcolorb}{\stampcolorb}
\def\pdftitle{\ny*\nx{} \gridname{} of \stampheight-by-\stampwidth{} squares}
\hypersetup{
  pdftitle=\pdftitle,
  pdfkeywords={%
      \ny*\nx{} \gridname,
      h,s: \stampheight{} | \stampvsep,
      w,s: \stampwidth{} | \stamphsep,
      c: \{\stampcolora; \stampcolorb\}
    },
  pdfsubject={https://github.com/maverickwoo/paperpad-templates},
  pdfauthor={Maverick Woo}
}

\input{body}
